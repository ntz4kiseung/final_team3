<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test.mybatis.IFollowDAO"> 
	
	<insert id="followinsert">
		INSERT INTO FOLLOW(ID, GIVEUSERID, TAKEUSERID, FOLLOWDATE) VALUES(FOLLOW_SEQ.NEXTVAL, #{userId}, #{followId}, SYSDATE)
	</insert>
	
	<delete id="followdelete">
		DELETE
		FROM FOLLOW
		WHERE GIVEUSERID = #{userId} AND TAKEUSERID = #{followId}
	</delete>

	<insert id="followinsert2">
		INSERT INTO FOLLOW(ID, GIVEUSERID, TAKEUSERID, FOLLOWDATE) VALUES(FOLLOW_SEQ.NEXTVAL, 'B001', #{followId}, SYSDATE)
	</insert>
	
	<delete id="followdelete2">
		DELETE
		FROM FOLLOW
		WHERE GIVEUSERID = 'B001' AND TAKEUSERID = #{followId}
	</delete>


  	<select id="followingList" resultType="com.test.mybatis.FollowDTO"> 
		SELECT DISTINCT UE.NICKNAME ,UE.USERID, UE.BADGELOGID, BL.BADGEPOINTID ,P.BADGEPOINTNAME,P.URL
                 , NVL2((SELECT ID FROM FOLLOW WHERE GIVEUSERID='B001' AND TAKEUSERID=UE.USERID),1,0) AS FOLLOWID
		FROM FOLLOW F LEFT JOIN USER_ESSENTIAL UE  ON  UE.USERID = F.TAKEUSERID
                        JOIN USER_BADGE_LOG BL ON UE.BADGELOGID=BL.BADGELOGID
                        JOIN POINT P ON BL.BADGEPOINTID=P.BADGEPOINTID
		WHERE F.GIVEUSERID='B001'   
		ORDER BY USERID
	</select> 
	
	<select id="followingBad" resultType="com.test.mybatis.FollowDTO"> 
		SELECT USERID, FN_PROFILE_BAD_BADGE(USERID) AS URLBAD
		FROM USER_ESSENTIAL UE JOIN FOLLOW F ON UE.USERID = F.TAKEUSERID
		WHERE F.GIVEUSERID='B001'
		ORDER BY USERID
	</select> 
	 	
	 	
	<select id="followingAddrList" resultType="com.test.mybatis.FollowDTO"> 
		SELECT USERID , MAX(ADDRSIID1) AS ADDRSINAME1 , MAX(ADDRGUID1) AS ADDRGUNAME1
		              ,MAX(ADDRSIID2) AS ADDRSINAME2 , MAX(ADDRGUID2) AS ADDRGUNAME2
		              ,MAX(ADDRSIID3) AS ADDRSINAME3 , MAX(ADDRGUID3) AS ADDRGUNAME3
		FROM 
		(
		SELECT USERID
		     , DECODE(NUM, 2, ADDRSINAME) AS ADDRSIID2
		     , DECODE(NUM, 2, ADDRGUNAME) AS ADDRGUID2
		     , DECODE(NUM, 3, ADDRGUNAME) AS ADDRGUID3
		      , DECODE(NUM, 3, ADDRSINAME) AS ADDRSIID3
		     , DECODE(NUM, 1, ADDRGUNAME) AS ADDRGUID1
		     , DECODE(NUM, 1, ADDRSINAME) AS ADDRSIID1
		FROM
		(
		SELECT UE.USERID, UA.ADDRGUID , ADDRSINAME, ADDRGUNAME, RANK() OVER(PARTITION BY UE.USERID ORDER BY UA.ADDRGUID) AS NUM 
		FROM USER_ESSENTIAL UE JOIN USER_ADDR UA ON UE.USERID=UA.USERID
		JOIN ADDR_GU AG ON UA.ADDRGUID = AG. ADDRGUID
		JOIN ADDR_SI AD ON AG.ADDRSIID = AD.ADDRSIID
		JOIN FOLLOW F ON UE.USERID = F. TAKEUSERID
		WHERE F.GIVEUSERID='B001'
		ORDER BY USERID, ADDRGUID
		)
		) GROUP BY USERID
		ORDER BY USERID
	</select> 
	 	
	
	<select id="followingInterList" resultType="com.test.mybatis.FollowDTO"> 	
		SELECT USERID , MAX(INTERMAINID1) AS INTERMAINNAME1 , MAX(INTERSUBID1) AS INTERSUBNAME1
		              ,MAX(INTERMAINID2) AS INTERMAINNAME2 , MAX(INTERSUBID2) AS INTERSUBNAME2
		              ,MAX(INTERMAINID3) AS INTERMAINNAME3 , MAX(INTERSUBID3) AS INTERSUBNAME3
		FROM 
		(
		SELECT USERID
		     , DECODE(NUM, 2, INTERSUBNAME) AS INTERSUBID3
		     , DECODE(NUM, 2, INTERMAINNAME) AS INTERMAINID3
		     , DECODE(NUM, 3, INTERSUBNAME) AS INTERSUBID2
		     , DECODE(NUM, 3, INTERMAINNAME) AS INTERMAINID2
		     , DECODE(NUM, 1, INTERSUBNAME) AS INTERSUBID1
		     , DECODE(NUM, 1, INTERMAINNAME) AS INTERMAINID1
		FROM
		(
		SELECT UE.USERID, UI.INTERSUBID, INTERSUBNAME, INTERMAINNAME , RANK() OVER(PARTITION BY UE.USERID ORDER BY UI.INTERSUBID) AS NUM 
		FROM USER_ESSENTIAL UE JOIN USER_INTEREST UI ON UE.USERID=UI.USERID
		JOIN INTEREST_SUB I ON UI.INTERSUBID = I.INTERSUBID
		JOIN INTEREST_MAIN IM ON I.INTERMAINID = IM.INTERMAINID
		JOIN FOLLOW F ON UE.USERID = F.TAKEUSERID
		WHERE F.GIVEUSERID='B001'
		ORDER BY USERID, INTERSUBID
		)
		) GROUP BY USERID
		ORDER BY USERID
	</select>  	


	
  	<select id="followerList" resultType="com.test.mybatis.FollowDTO"> 
		  SELECT DISTINCT UE.NICKNAME ,UE.USERID, UE.BADGELOGID, BL.BADGEPOINTID ,P.BADGEPOINTNAME,P.URL               
                 , NVL2((SELECT ID FROM FOLLOW WHERE GIVEUSERID='B001' AND TAKEUSERID=UE.USERID),1,0) AS FOLLOWID
		FROM FOLLOW F LEFT JOIN USER_ESSENTIAL UE  ON  UE.USERID = F.GIVEUSERID
                        JOIN USER_BADGE_LOG BL ON UE.BADGELOGID=BL.BADGELOGID
                        JOIN POINT P ON BL.BADGEPOINTID=P.BADGEPOINTID                      
		WHERE F.TAKEUSERID='B001'
        ORDER BY USERID
	</select> 
	
	
	<select id="followerBad" resultType="com.test.mybatis.FollowDTO"> 
		SELECT USERID, FN_PROFILE_BAD_BADGE(USERID) AS URLBAD
		FROM USER_ESSENTIAL UE JOIN FOLLOW F ON UE.USERID = F.GIVEUSERID
		WHERE F.TAKEUSERID='B001'
		ORDER BY USERID
	</select> 
	 	

	<select id="followerAddrList" resultType="com.test.mybatis.FollowDTO"> 
		SELECT USERID , MAX(ADDRSIID1) AS ADDRSINAME1 , MAX(ADDRGUID1) AS ADDRGUNAME1
              ,MAX(ADDRSIID2) AS ADDRSINAME2 , MAX(ADDRGUID2) AS ADDRGUNAME2
              ,MAX(ADDRSIID3) AS ADDRSINAME3 , MAX(ADDRGUID3) AS ADDRGUNAEM3
		FROM 
		(
		SELECT USERID
		     , DECODE(NUM, 2, ADDRSINAME) AS ADDRSIID2
		     , DECODE(NUM, 2, ADDRGUNAME) AS ADDRGUID2
		     , DECODE(NUM, 3, ADDRGUNAME) AS ADDRGUID3
		      , DECODE(NUM, 3, ADDRSINAME) AS ADDRSIID3
		     , DECODE(NUM, 1, ADDRGUNAME) AS ADDRGUID1
		     , DECODE(NUM, 1, ADDRSINAME) AS ADDRSIID1
		FROM
		(
		SELECT UE.USERID, UA.ADDRGUID , ADDRSINAME, ADDRGUNAME, RANK() OVER(PARTITION BY UE.USERID ORDER BY UA.ADDRGUID) AS NUM 
		FROM USER_ESSENTIAL UE JOIN USER_ADDR UA ON UE.USERID=UA.USERID
		JOIN ADDR_GU AG ON UA.ADDRGUID = AG. ADDRGUID
		JOIN ADDR_SI AD ON AG.ADDRSIID = AD.ADDRSIID
		JOIN FOLLOW F ON UE.USERID = F. GIVEUSERID
		WHERE F.TAKEUSERID='B001'
		ORDER BY USERID, ADDRGUID
		)
		) GROUP BY USERID
		ORDER BY USERID
	</select> 
	 	
	
	<select id="followerInterList" resultType="com.test.mybatis.FollowDTO"> 	
		SELECT USERID , MAX(INTERMAINID1) AS INTERMAINNAME1 , MAX(INTERSUBID1) AS INTERSUBNAME1
              ,MAX(INTERMAINID2) AS INTERMAINNAME2 , MAX(INTERSUBID2) AS INTERSUBNAME2
		              ,MAX(INTERMAINID3) AS INTERMAINNAME3 , MAX(INTERSUBID3) AS INTERSUBNAME3
		FROM 
		(
		SELECT USERID
		     , DECODE(NUM, 2, INTERSUBNAME) AS INTERSUBID3
		     , DECODE(NUM, 2, INTERMAINNAME) AS INTERMAINID3
		     , DECODE(NUM, 3, INTERSUBNAME) AS INTERSUBID2
		     , DECODE(NUM, 3, INTERMAINNAME) AS INTERMAINID2
		     , DECODE(NUM, 1, INTERSUBNAME) AS INTERSUBID1
		     , DECODE(NUM, 1, INTERMAINNAME) AS INTERMAINID1
		FROM
		(
		SELECT UE.USERID, UI.INTERSUBID, INTERSUBNAME, INTERMAINNAME , RANK() OVER(PARTITION BY UE.USERID ORDER BY UI.INTERSUBID) AS NUM 
		FROM USER_ESSENTIAL UE JOIN USER_INTEREST UI ON UE.USERID=UI.USERID
		JOIN INTEREST_SUB I ON UI.INTERSUBID = I.INTERSUBID
		JOIN INTEREST_MAIN IM ON I.INTERMAINID = IM.INTERMAINID
		JOIN FOLLOW F ON UE.USERID = F.GIVEUSERID
		WHERE F.TAKEUSERID='B001'
		ORDER BY USERID, INTERSUBID
		)
		) GROUP BY USERID
		ORDER BY USERID
	</select>  	
  
</mapper>
