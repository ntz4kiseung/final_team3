<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.test.mybatis.IUserDAO"> 
  	
  	
  	<select id="myPageList" resultType="com.test.mybatis.UserDTO"> 
	SELECT DISTINCT UE.USERID, UE.NICKNAME,UE.NAME,UE.BIRTH,G.GENDER,UE.TEL,US.SNS, US.INTRODUCE
                ,UE.EMAIL,UE.BADGELOGID, BL.BADGEPOINTID ,P.BADGEPOINTNAME,P.URL,NVL2((SELECT C.CERTINAME 
                    FROM USER_CERTIFICATION U JOIN CERTIFICATION_CATE C
                    ON U.CERTIID = C.CERTIID 
                    WHERE U.USERID=  UE.USERID AND C.CERTIID = 'CT00001'),'휴대폰 인증 완료 ✔','') AS TELCHECK
                 , NVL2((SELECT C.CERTINAME FROM USER_CERTIFICATION U JOIN CERTIFICATION_CATE C
                  ON U.CERTIID = C.CERTIID
                  WHERE U.USERID= UE.USERID AND C.CERTIID = 'CT00002'),'이메일 인증 완료 ✔' ,'') AS EMAILCHECK
                  ,ROUND(AVG(R.GRADE)OVER(),1) AS REVIEWGRADE 
	FROM USER_ESSENTIAL UE  JOIN USER_SUB US ON UE.USERID = US.USERID 
                        JOIN USER_BADGE_LOG BL ON UE.BADGELOGID=BL.BADGELOGID	                     
                        JOIN POINT P ON BL.BADGEPOINTID=P.BADGEPOINTID
                        JOIN REVIEW R ON UE.USERID = R.TAKEUSERID
                        JOIN GENDER G ON G.GENDERID = UE.GENDERID                      
	WHERE UE.USERID='aberine'
	</select> 
	
	<select id="MyPageBad" resultType="com.test.mybatis.UserDTO"> 
		SELECT USERID, FN_PROFILE_BAD_BADGE(USERID) AS URLBAD
		FROM USER_ESSENTIAL
		WHERE USERID='aberine'
	</select> 
	 	


	<select id="myPageAddrList" resultType="com.test.mybatis.AddrDTO"> 
		SELECT *
		FROM
		(
		    SELECT USERID ,ID ,ADDRSINAME AS ADDRSINAME1 , ADDRGUNAME AS ADDRGUNAME1
		                ,LEAD(ADDRSINAME,1) OVER (ORDER BY ID) AS ADDRSINAME2,LEAD(ADDRGUNAME,1) OVER (ORDER BY ID) AS ADDRGUNAME2
		                , LEAD(ADDRSINAME,2) OVER (ORDER BY ID) AS ADDRSINAME3,LEAD(ADDRGUNAME,2) OVER (ORDER BY ID) AS ADDRGUNAME3
		    FROM USERADDR_VIEW
		    WHERE USERID='aberine'
		)
		WHERE ID=(SELECT MIN(ID) FROM USERADDR_VIEW WHERE USERID='aberine')
	</select> 
	 	
	
	<select id="myPageInterList" resultType="com.test.mybatis.InterDTO"> 
		SELECT USERID, ID, INTERMAINNAME1, INTERSUBNAME1, INTERMAINNAME2, INTERSUBNAME2, INTERMAINNAME3, INTERSUBNAME3
		FROM
		(
		    SELECT USERID ,ID ,INTERSUBNAME AS INTERSUBNAME1 , INTERMAINNAME AS INTERMAINNAME1
		                ,LEAD(INTERSUBNAME,1) OVER (ORDER BY ID) AS INTERSUBNAME2,LEAD(INTERMAINNAME,1) OVER (ORDER BY ID) AS INTERMAINNAME2
		                , LEAD(INTERSUBNAME,2) OVER (ORDER BY ID) AS INTERSUBNAME3,LEAD(INTERMAINNAME,2) OVER (ORDER BY ID) AS INTERMAINNAME3
		    FROM USERINTER_VIEW
		    WHERE USERID='aberine'
		)
		WHERE ID=(SELECT MIN(ID) FROM USERINTER_VIEW WHERE USERID='aberine')
		
	</select>  	
	
	

	
  
</mapper>
