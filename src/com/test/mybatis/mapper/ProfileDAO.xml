<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.test.mybatis.IUserDAO">

	<select id="profile" resultType="com.test.mybatis.UserDTO">
		SELECT DISTINCT UE.USERID AS USERID, UE.NICKNAME AS NICKNAME,UE.BADGELOGID AS BADGELOGID, BL.BADGEPOINTID AS BADGEPOINTID,P.BADGEPOINTNAME AS BADGEPOINTNAME,P.URL AS URL,NVL2((SELECT C.CERTINAME 
                    FROM USER_CERTIFICATION U JOIN CERTIFICATION_CATE C
                    ON U.CERTIID = C.CERTIID 
                    WHERE U.USERID=  UE.USERID AND C.CERTIID = 'CT00001'),'휴대폰 인증 완료 ✔','') AS TELCHECK
                 , NVL2((SELECT C.CERTINAME FROM USER_CERTIFICATION U JOIN CERTIFICATION_CATE C
                  ON U.CERTIID = C.CERTIID
                  WHERE U.USERID= UE.USERID AND C.CERTIID = 'CT00002'),'이메일 인증 완료 ✔' ,'') AS EMAILCHECK
                  ,ROUND(AVG(R.GRADE)OVER(),1) AS REVIEWGRADE
		FROM USER_ESSENTIAL UE JOIN USER_BADGE_LOG BL ON UE.BADGELOGID=BL.BADGELOGID
		                       JOIN POINT P ON BL.BADGEPOINTID=P.BADGEPOINTID
		                       JOIN REVIEW R
		                      ON UE.USERID = R.TAKEUSERID
		WHERE UE.USERID='B001'
	</select>
	

	
</mapper>
